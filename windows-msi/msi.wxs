<?xml version="1.0" encoding="utf-8"?>
<!--
  openvpn-build â€” OpenVPN packaging

  Copyright (C) 2018 Simon Rozman <simon@rozman.si>

  This program is free software; you can redistribute it and/or modify
  it under the terms of the GNU General Public License version 2
  as published by the Free Software Foundation.

  This program is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License along
  with this program; if not, write to the Free Software Foundation, Inc.,
  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301 USA.
-->
<Wix
    xmlns="http://schemas.microsoft.com/wix/2006/wi"
    xmlns:diffx="http://schemas.microsoft.com/wix/DifxAppExtension"
    xmlns:iis="http://schemas.microsoft.com/wix/IIsExtension">
    <Product
        Id="$(var.PRODUCT_VERSION_GUID)"
        UpgradeCode="$(var.PRODUCT_UPGRADE_GUID)"
        Version="$(var.PRODUCT_VERSION)"
        Language="1033"
        Name="$(var.PRODUCT_NAME) $(var.PRODUCT_VERSION)-$(var.PRODUCT_PLATFORM)"
        Manufacturer="$(var.PRODUCT_PUBLISHER)">

        <Package
            InstallScope="perMachine"
            InstallerVersion="400"
            Compressed="yes"
            SummaryCodepage="1252"
            ReadOnly="yes"/>

        <Media
            Id="1"
            Cabinet="openvpn.cab"
            EmbedCab="yes"/>

        <Icon
            Id="genkey.ico"
            SourceFile="artwork\genkey.ico"/>
        <Icon
            Id="openvpn.ico"
            SourceFile="artwork\openvpn.ico"/>
        <Icon
            Id="tapctl_create.ico"
            SourceFile="artwork\tapctl_create.ico"/>
        <Icon
            Id="url.ico"
            SourceFile="artwork\url.ico"/>

        <!--
            Code signing certificate the driver is signed with.
        -->
        <Binary
            Id="OpenVPN.cer"
            SourceFile="!(bindpath.tapbin)signed_by.cer"/>

        <Property Id="ARPPRODUCTICON" Value="openvpn.ico"/>
        <Property Id="ARPURLINFOABOUT" Value="https://openvpn.net/index.php/open-source/"/>
        <Property Id="ARPURLUPDATEINFO" Value="https://openvpn.net/index.php/open-source/downloads.html"/>
        <Property Id="SimpleProductName" Value="$(var.PRODUCT_NAME)"/>
        <Property Id="DisplayVersion" Value="$(var.PRODUCT_VERSION)"/>
        <Property Id="MSICHECKCRCS" Value="1"/>
        <Property Id="PROMPTROLLBACKCOST" Value="P"/>
        <Property Id="EDITOR" Value="notepad.exe"/>


        <!--
            Launch conditions
        -->
        <Condition Message="[SimpleProductName] requires Windows Vista or later version of Windows.">Installed OR (VersionNT&gt;=600)</Condition>
        <?if $(sys.BUILDARCH)~="x86" Or $(sys.BUILDARCH)~="ARM" ?>
        <Condition Message="You are attempting to install a 32-bit variant of [SimpleProductName] on a 64-bit operating system. The 32-bit variant will not work with your operating system. An installation of a 64-bit variant is recommended.">Installed OR NOT VersionNT64</Condition>
        <?endif?>


        <!--
            Upgrading functionality
        -->
        <MajorUpgrade
            DowngradeErrorMessage="A newer version of [SimpleProductName] is already installed. Setup will now exit."
            Schedule="afterInstallExecute"/>


        <!--
            1. Initialize install folder with registry folder if detected.
            2. Set install folder to the previous installation folder if detected. Use license.txt file to detect previous installation folder.
            3. Allow overriding install folder by specifying INSTALLDIR=<folder> on the msiexec.exe command line.
        -->
        <Property Id="PRODUCTDIRREG">
            <RegistrySearch Id="reg.path" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Type="directory"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetProductDirReg"
            Id="PRODUCTDIR"
            Value="[PRODUCTDIRREG]"
            Sequence="first">PRODUCTDIRREG AND NOT Installed</SetProperty>
        <Property Id="PRODUCTDIRPREV">
            <ComponentSearch Id="license.txt" Guid="{20A13016-5269-48AA-9932-F6E7CE044F40}"/>
        </Property>
        <SetProperty
            After="SetProductDirReg"
            Action="SetProductDirPrev"
            Id="PRODUCTDIR"
            Value="[PRODUCTDIRPREV]"
            Sequence="first">PRODUCTDIRPREV AND NOT Installed</SetProperty>
        <SetProperty
            After="SetProductDirPrev"
            Action="SetProductDirParam"
            Id="PRODUCTDIR"
            Value="[INSTALLDIR]"
            Sequence="first">INSTALLDIR AND NOT Installed</SetProperty>


        <!--
            1. Set configuration folder with registry folder if detected.
            2. Set configuration folder to the previous installation folder if detected. Use README.txt file to detect previous configuration folder.
            3. Allow overriding configuration folder by specifying CONFIG=<folder> on the msiexec.exe command line.
        -->
        <Property Id="CONFIGDIRREG">
            <RegistrySearch Id="reg.config_dir" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="config_dir" Type="directory"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetConfigDirReg"
            Id="CONFIGDIR"
            Value="[CONFIGDIRREG]"
            Sequence="first">CONFIGDIRREG AND NOT Installed</SetProperty>
        <Property Id="CONFIGDIRPREV">
            <ComponentSearch Id="cfg.README.txt" Guid="{9C3B43AF-1399-4E6A-92CA-D7BA3B6BCC3C}"/>
        </Property>
        <SetProperty
            After="SetConfigDirReg"
            Action="SetConfigDirPrev"
            Id="CONFIGDIR"
            Value="[CONFIGDIRPREV]"
            Sequence="first">CONFIGDIRPREV AND NOT Installed</SetProperty>
        <SetProperty
            After="SetConfigDirPrev"
            Action="SetConfigDirParam"
            Id="CONFIGDIR"
            Value="[CONFIG]"
            Sequence="first">CONFIG AND NOT Installed</SetProperty>


        <!--
            1. Set executables folder with registry folder if detected.
            2. Set executables folder to the previous executable folder if detected. Use openvpn.exe file to detect previous executable folder.
        -->
        <Property Id="BINDIRREG">
            <RegistrySearch Id="reg.exe_path" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="exe_path" Type="file"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetBinDirReg"
            Id="BINDIR"
            Value="[BINDIRREG]"
            Sequence="first">BINDIRREG AND NOT Installed</SetProperty>
        <Property Id="BINDIRPREV">
            <ComponentSearch Id="bin.openvpn.exe" Guid="{4D920FC9-DF3C-4D34-ADE6-3EEEF8AE901A}"/>
        </Property>
        <SetProperty
            After="SetBinDirReg"
            Action="SetBinDirPrev"
            Id="BINDIR"
            Value="[BINDIRPREV]"
            Sequence="first">BINDIRPREV AND NOT Installed</SetProperty>


        <!--
            1. Set documentation folder to the previous documentation folder if detected. Use INSTALL_win32.txt file to detect previous documentation folder.
        -->
        <Property Id="DOCDIRPREV">
            <ComponentSearch Id="doc.INSTALL_win32.txt" Guid="{2437051B-8A0A-4391-BA43-C2DE4BCCBDD5}"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetDocDirPrev"
            Id="DOCDIR"
            Value="[DOCDIRPREV]"
            Sequence="first">DOCDIRPREV AND NOT Installed</SetProperty>


        <!--
            1. Set Easy RSA folder to the previous Easy RSA folder if detected. Use README.txt file to detect previous Easy RSA folder.
            2. Allow overriding Easy RSA folder by specifying EASYRSA=<folder> on the msiexec.exe command line.
        -->
        <Property Id="EASYRSADIRPREV">
            <ComponentSearch Id="easyrsa.README.txt" Guid="{69F47537-3E49-4768-9953-BD880272A13B}"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetEasyRSADirPrev"
            Id="EASYRSADIR"
            Value="[EASYRSADIRPREV]"
            Sequence="first">EASYRSADIRPREV AND NOT Installed</SetProperty>
        <SetProperty
            After="SetEasyRSADirPrev"
            Action="SetEasyRSADirParam"
            Id="EASYRSADIR"
            Value="[EASYRSA]"
            Sequence="first">EASYRSA AND NOT Installed</SetProperty>


        <!--
            1. Set log folder with registry folder if detected.
            2. Set log folder to the previous log folder if detected. Use README.txt file to detect previous log folder.
            3. Allow overriding log folder by specifying LOG=<folder> on the msiexec.exe command line.
        -->
        <Property Id="LOGDIRREG">
            <RegistrySearch Id="reg.log_dir" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="log_dir" Type="directory"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetLogDirReg"
            Id="LOGDIR"
            Value="[LOGDIRREG]"
            Sequence="first">LOGDIRREG AND NOT Installed</SetProperty>
        <Property Id="LOGDIRPREV">
            <ComponentSearch Id="log.README.txt" Guid="{CD05C1F7-99E7-45C9-8DE5-9C7FB73EE911}"/>
        </Property>
        <SetProperty
            After="SetLogDirReg"
            Action="SetLogDirPrev"
            Id="LOGDIR"
            Value="[LOGDIRPREV]"
            Sequence="first">LOGDIRPREV AND NOT Installed</SetProperty>
        <SetProperty
            After="SetLogDirPrev"
            Action="SetLogDirParam"
            Id="LOGDIR"
            Value="[LOG]"
            Sequence="first">LOG AND NOT Installed</SetProperty>


        <!--
            1. Initialize log append setting with default value.
            2. Set log append setting with registry value if detected.
        -->
        <Property Id="LOGAPPEND" Value="0"/>
        <Property Id="LOGAPPENDREG">
            <RegistrySearch Id="reg.log_append" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="log_append" Type="raw"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetLogAppendReg"
            Id="LOGAPPEND"
            Value="[LOGAPPENDREG]"
            Sequence="first">LOGAPPENDREG AND NOT Installed</SetProperty>


        <!--
            1. Initialize disable save password setting with default value.
            2. Set disable save password setting with registry value if detected.
        -->
        <Property Id="DISABLESAVEPWD" Value="0"/>
        <Property Id="DISABLESAVEPWDREG">
            <RegistrySearch Id="reg.disable_save_passwords" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="disable_save_passwords" Type="raw"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetDisableSavePwdReg"
            Id="DISABLESAVEPWD"
            Value="[DISABLESAVEPWDREG]"
            Sequence="first">DISABLESAVEPWDREG AND NOT Installed</SetProperty>


        <!--
            1. Initialize OpenVPN administrators group setting with default value.
            2. Set OpenVPN administrators group setting with registry value if detected.
        -->
        <Property Id="ADMINGROUP" Value="$(var.PRODUCT_NAME) Administrators"/>
        <Property Id="ADMINGROUPREG">
            <RegistrySearch Id="reg.ovpn_admin_group" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="ovpn_admin_group" Type="raw"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetAdminGroupReg"
            Id="ADMINGROUP"
            Value="[ADMINGROUPREG]"
            Sequence="first">ADMINGROUPREG AND NOT Installed</SetProperty>


        <!--
            1. Initialize priority setting with default value.
            2. Set priority setting with registry value if detected.
        -->
        <Property Id="PRIORITY" Value="NORMAL_PRIORITY_CLASS"/>
        <Property Id="PRIORITYREG">
            <RegistrySearch Id="reg.priority" Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_NAME)" Name="priority" Type="raw"/>
        </Property>
        <SetProperty
            After="AppSearch"
            Action="SetPriorityReg"
            Id="PRIORITY"
            Value="[PRIORITYREG]"
            Sequence="first">PRIORITYREG AND NOT Installed</SetProperty>


        <!--
            Folders/Files
        -->
        <Directory Id="TARGETDIR" Name="SourceDir">
            <Directory Id="$(var.PROGRAM_FILES_DIR)">
                <Directory Id="PRODUCTDIR" Name="$(var.PRODUCT_NAME)">
                    <Component Id="license.txt" Guid="{20A13016-5269-48AA-9932-F6E7CE044F40}">
                        <File Name="license.txt" Source="!(bindpath.build)$(var.PRODUCT_PLATFORM)\license.txt"/>

                        <!-- Clean-up NSIS installation. -->
                        <!-- TODO: remove stale files. -->
                        <!--<RemoveRegistryKey Root="HKLM" Key="SOFTWARE\$(var.PRODUCT_TAP_NAME)"                                            Action="removeOnInstall"/>
                        <RemoveRegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(var.PRODUCT_TAP_NAME)" Action="removeOnInstall"/>
                        <RemoveRegistryKey Root="HKLM" Key="SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall\$(var.PRODUCT_NAME)"     Action="removeOnInstall"/>-->
                    </Component>

                    <Directory Id="BINDIR" Name="bin">
                        <Component Id="bin.libcrypto_1_1.dll" Guid="{811694A9-DC99-4CFA-BD72-4877F8E32C7C}">
                            <File Name="libcrypto-1_1$(var.OPENSSL_PLAT).dll" Source="!(bindpath.openvpn)bin\libcrypto-1_1$(var.OPENSSL_PLAT).dll"/>
                        </Component>
                        <Component Id="bin.liblzo2_2.dll" Guid="{A1A057F0-235B-4F55-9A3A-CDA2112648F8}">
                            <File Name="liblzo2-2.dll" Source="!(bindpath.openvpn)bin\liblzo2-2.dll"/>
                        </Component>
                        <Component Id="bin.libpkcs11_helper_1.dll" Guid="{62BB5466-934A-41FE-989B-9D0B6BD5151F}">
                            <File Name="libpkcs11-helper-1.dll" Source="!(bindpath.openvpn)bin\libpkcs11-helper-1.dll"/>
                        </Component>
                        <Component Id="bin.libssl_1_1.dll" Guid="{34B9FB21-7621-4C6A-8CA0-2C907F6ADDCE}">
                            <File Name="libssl-1_1$(var.OPENSSL_PLAT).dll" Source="!(bindpath.openvpn)bin\libssl-1_1$(var.OPENSSL_PLAT).dll"/>
                        </Component>
                        <Component Id="bin.openssl.exe" Guid="{E8876024-809B-40F1-A13B-A0DACFAA0AF0}">
                            <File Name="openssl.exe" Source="!(bindpath.openvpn)bin\openssl.exe"/>
                        </Component>
                        <Component Id="bin.openvpn.exe" Guid="{4D920FC9-DF3C-4D34-ADE6-3EEEF8AE901A}">
                            <File Id="bin.openvpn.exe" Name="openvpn.exe" Source="!(bindpath.openvpn)bin\openvpn.exe"/>
                        </Component>
                        <Component Id="bin.openvpn_gui.exe" Guid="{5A893CD4-EA7E-4887-89D0-15BBE904FE11}">
                            <File Name="openvpn-gui.exe" Source="!(bindpath.openvpn)bin\openvpn-gui.exe"/>
                        </Component>
                        <Component Id="bin.openvpnserv.exe" Guid="{43A4F408-9399-4BD7-9978-0ECE4A582929}">
                            <File Name="openvpnserv.exe" Source="!(bindpath.openvpn)bin\openvpnserv.exe"/>
                            <ServiceControl
                                Id="OpenVPNServiceInteractive"
                                Name="OpenVPNServiceInteractive"
                                Start="install"
                                Stop="both"
                                Remove="uninstall"/>
                            <ServiceInstall
                                Id="OpenVPNServiceInteractive"
                                Name="OpenVPNServiceInteractive"
                                DisplayName="OpenVPN Interactive Service"
                                Description="Allows OpenVPN GUI and other clients to establish OpenVPN connections without administrative privileges in a secure way."
                                Type="shareProcess"
                                Start="auto"
                                ErrorControl="normal">
                                <ServiceDependency Id="$(var.PRODUCT_TAP_WIN_COMPONENT_ID)"/>
                                <ServiceDependency Id="Dhcp"/>
                            </ServiceInstall>
                            <ServiceControl
                                Id="OpenVPNServiceLegacy"
                                Name="OpenVPNServiceLegacy"
                                Stop="both"
                                Remove="uninstall"/>
                            <ServiceInstall
                                Id="OpenVPNServiceLegacy"
                                Name="OpenVPNServiceLegacy"
                                DisplayName="OpenVPN Legacy Service"
                                Type="shareProcess"
                                Start="demand"
                                ErrorControl="normal">
                                <ServiceDependency Id="$(var.PRODUCT_TAP_WIN_COMPONENT_ID)"/>
                                <ServiceDependency Id="Dhcp"/>
                            </ServiceInstall>
                        </Component>
                        <Component Id="bin.openvpnserv2.exe" Guid="{8867EEBF-B928-49D7-A1F5-D33E2BCAAD70}">
                            <File Name="openvpnserv2.exe" Source="!(bindpath.openvpnserv2)openvpnserv2.exe"/>
                            <ServiceControl
                                Id="OpenVPNService"
                                Name="OpenVPNService"
                                Stop="both"
                                Remove="uninstall"/>
                            <ServiceInstall
                                Id="OpenVPNService"
                                Name="OpenVPNService"
                                DisplayName="OpenVPNService"
                                Type="ownProcess"
                                Start="demand"
                                ErrorControl="normal">
                                <ServiceDependency Id="$(var.PRODUCT_TAP_WIN_COMPONENT_ID)"/>
                                <ServiceDependency Id="Dhcp"/>
                            </ServiceInstall>
                        </Component>
                        <Component Id="bin.tapctl.exe" Guid="{5A294591-0F71-470F-977B-DD288AB2B437}">
                            <File Name="tapctl.exe" Source="!(bindpath.openvpn)bin\tapctl.exe" KeyPath="yes"/>
                        </Component>
                    </Directory>

                    <Directory Id="CONFIGDIR" Name="config">
                        <Component Id="cfg.README.txt" Guid="{9C3B43AF-1399-4E6A-92CA-D7BA3B6BCC3C}">
                            <File Id="cfg.README.txt" Name="README.txt" Source="!(bindpath.build)README-config.txt"/>
                        </Component>
                    </Directory>

                    <Directory Id="DOCDIR" Name="doc">
                        <Component Id="doc.INSTALL_win32.txt" Guid="{2437051B-8A0A-4391-BA43-C2DE4BCCBDD5}">
                            <File Name="INSTALL-win32.txt" Source="..\windows-nsis\INSTALL-win32.txt"/>
                        </Component>
                        <Component Id="doc.openvpn.8.html" Guid="{81E681BB-B296-44FC-B547-595459E7CE1B}">
                            <File Name="openvpn.8.html" Source="!(bindpath.openvpn)share\doc\openvpn\openvpn.8.html"/>
                        </Component>
                        <Component Id="doc.howto.url" Guid="{B4C9CC15-3B27-429B-8AA5-E10B4C3EDB89}">
                            <File Name="$(var.PRODUCT_NAME) HOWTO.url" Source="bookmarks\howto.url"/>
                        </Component>
                        <Component Id="doc.support.url" Guid="{3838426E-5464-4C29-8690-51F025DEAD99}">
                            <File Name="$(var.PRODUCT_NAME) Support.url" Source="bookmarks\support.url"/>
                        </Component>
                        <Component Id="doc.website.url" Guid="{A09AD1CA-2296-48F3-B505-ECA592B097B0}">
                            <File Name="$(var.PRODUCT_NAME) Web Site.url" Source="bookmarks\website.url"/>
                        </Component>
                        <Component Id="doc.wiki.url" Guid="{34EFDCA3-1A65-48A0-B41D-F73C0C481E7B}">
                            <File Name="$(var.PRODUCT_NAME) Wiki.url" Source="bookmarks\wiki.url"/>
                        </Component>
                    </Directory>

                    <Directory Id="DRIVERDIR" Name="driver">
                        <Component Id="driver.OemVista.inf" Guid="{7656C849-96D7-40FE-B70F-4C7567AB295F}">
                            <File Name="OemVista.inf" Source="!(bindpath.tapbin)OemVista.inf"/>
                        </Component>
                        <Component Id="driver.$(var.PRODUCT_TAP_WIN_COMPONENT_ID).cat" Guid="{817B6909-DA22-4D0A-B318-B3B93BED5998}">
                            <File Name="$(var.PRODUCT_TAP_WIN_COMPONENT_ID).cat" Source="!(bindpath.tapbin)$(var.PRODUCT_TAP_WIN_COMPONENT_ID).cat"/>
                            <iis:Certificate
                                Id="OpenVPN.cer"
                                Name="OpenVPN Technologies, Inc."
                                StoreLocation="localMachine"
                                StoreName="trustedPublisher"
                                BinaryKey="OpenVPN.cer"
                                Request="no"/>
                            <diffx:Driver
                                AddRemovePrograms="no"
                                PlugAndPlayPrompt="no"/>
                        </Component>
                        <Component Id="driver.$(var.PRODUCT_TAP_WIN_COMPONENT_ID).sys" Guid="{C629FA48-5F02-4BCE-9CB9-F8E076DEFBCF}">
                            <File Name="$(var.PRODUCT_TAP_WIN_COMPONENT_ID).sys" Source="!(bindpath.tapbin)$(var.PRODUCT_TAP_WIN_COMPONENT_ID).sys"/>
                        </Component>
                    </Directory>

                    <Directory Id="EASYRSADIR" Name="easy-rsa">
                        <Component Id="easyrsa.build_ca.bat" Guid="{C1F541D5-2D17-47EF-B3D7-9A05C0C7C9F4}">
                            <File Name="build-ca.bat" Source="!(bindpath.easyrsa)Windows\build-ca.bat"/>
                        </Component>
                        <Component Id="easyrsa.build_dh.bat" Guid="{7A21A71D-D84C-49F3-9752-32A8EE260043}">
                            <File Name="build-dh.bat" Source="!(bindpath.easyrsa)Windows\build-dh.bat"/>
                        </Component>
                        <Component Id="easyrsa.build_key.bat" Guid="{5A1F6F9A-B25E-45AA-992B-640CCF9B3F14}">
                            <File Name="build-key.bat" Source="!(bindpath.easyrsa)Windows\build-key.bat"/>
                        </Component>
                        <Component Id="easyrsa.build_key_pass.bat" Guid="{AF9B9A96-C661-408B-861C-328F3DE3300B}">
                            <File Name="build-key-pass.bat" Source="!(bindpath.easyrsa)Windows\build-key-pass.bat"/>
                        </Component>
                        <Component Id="easyrsa.build_key_pkcs12.bat" Guid="{01C35157-7DA3-4D64-9C1F-8E35D05B6760}">
                            <File Name="build-key-pkcs12.bat" Source="!(bindpath.easyrsa)Windows\build-key-pkcs12.bat"/>
                        </Component>
                        <Component Id="easyrsa.build_key_server.bat" Guid="{99509E1B-6946-4BB9-BDAC-39088F8F3C1C}">
                            <File Name="build-key-server.bat" Source="!(bindpath.easyrsa)Windows\build-key-server.bat"/>
                        </Component>
                        <Component Id="easyrsa.clean_all.bat" Guid="{B14B1938-6F89-4FE5-A7C4-83EFDFF99A16}">
                            <File Name="clean-all.bat" Source="!(bindpath.easyrsa)Windows\clean-all.bat"/>
                        </Component>
                        <Component Id="easyrsa.index.txt.start" Guid="{BFBB96C5-3D98-40CE-B466-84CBFBFD9860}">
                            <File Name="index.txt.start" Source="!(bindpath.easyrsa)Windows\index.txt.start"/>
                        </Component>
                        <Component Id="easyrsa.init_config.bat" Guid="{BE6634C8-4C65-4A34-BA36-ECA89B70D4B7}">
                            <File Name="init-config.bat" Source="!(bindpath.easyrsa)Windows\init-config.bat"/>
                        </Component>
                        <Component Id="easyrsa.openssl_1.0.0.cnf" Guid="{3DF64587-2D75-4157-8EDC-8865918F347E}">
                            <File Name="openssl-1.0.0.cnf" Source="!(bindpath.easyrsa)2.0\openssl-1.0.0.cnf"/>
                        </Component>
                        <Component Id="easyrsa.README.txt" Guid="{69F47537-3E49-4768-9953-BD880272A13B}">
                            <File Id="easyrsa.README.txt" Name="README.txt" Source="!(bindpath.easyrsa)Windows\README.txt"/>
                        </Component>
                        <Component Id="easyrsa.revoke_full.bat" Guid="{E3CE1DCB-9216-4DEE-9328-B8B68CE98D0A}">
                            <File Name="revoke-full.bat" Source="!(bindpath.easyrsa)Windows\revoke-full.bat"/>
                        </Component>
                        <Component Id="easyrsa.serial.start" Guid="{F8AE1791-B35C-42AF-8E98-B21CEBCD8DB0}">
                            <File Name="serial.start" Source="!(bindpath.easyrsa)Windows\serial.start"/>
                        </Component>
                        <Component Id="easyrsa.vars.bat.sample" Guid="{24A177A9-238C-46BC-A2A5-7884F39406D0}">
                            <File Name="vars.bat.sample" Source="!(bindpath.easyrsa)Windows\vars.bat.sample"/>
                        </Component>
                    </Directory>

                    <Directory Id="INCLUDEDIR" Name="include">
                        <Component Id="include.tap_windows.h" Guid="{55A1A7C4-202A-47A5-9066-1C96ADD232AC}">
                            <File Name="tap-windows.h" Source="!(bindpath.tap)include\tap-windows.h"/>
                        </Component>
                    </Directory>

                    <Directory Id="LOGDIR" Name="log">
                        <Component Id="log.README.txt" Guid="{CD05C1F7-99E7-45C9-8DE5-9C7FB73EE911}">
                            <File Id="log.README.txt" Name="README.txt" Source="!(bindpath.build)README-log.txt"/>
                        </Component>
                    </Directory>

                    <Directory Id="RESDIR" Name="res">
                        <Component Id="res.ovpn.ico" Guid="{01C7FEE2-2F5B-4BBF-A7CF-7B7B5E2B44D2}">
                            <File Id="res.ovpn.ico" Name="ovpn.ico" Source="artwork\ovpn.ico"/>
                        </Component>
                    </Directory>

                    <Directory Id="SAMPLECFGDIR" Name="sample-config">
                        <Component Id="samplecfg.client.$(var.CONFIG_EXTENSION)" Guid="{5A762634-C12E-4D34-B9C6-D6C33513FAF8}">
                            <File Name="client.$(var.CONFIG_EXTENSION)" Source="!(bindpath.build)$(var.PRODUCT_PLATFORM)\client.ovpn"/>
                        </Component>
                        <Component Id="samplecfg.sample.$(var.CONFIG_EXTENSION)" Guid="{48ECE02F-3E2B-4708-B736-8D36CBCFF509}">
                            <File Name="sample.$(var.CONFIG_EXTENSION)" Source="!(bindpath.build)$(var.PRODUCT_PLATFORM)\sample.ovpn"/>
                        </Component>
                        <Component Id="samplecfg.server.$(var.CONFIG_EXTENSION)" Guid="{B0B5E776-3C7A-4B86-87BF-6FAFF9F83E34}">
                            <File Name="server.$(var.CONFIG_EXTENSION)" Source="!(bindpath.build)$(var.PRODUCT_PLATFORM)\server.ovpn"/>
                        </Component>
                    </Directory>
                </Directory>
            </Directory>

            <Directory Id="ProgramMenuFolder">
                <Directory Id="ProductShortcutFolder" Name="$(var.PRODUCT_NAME)">
                    <Component Id="shortcut.openvpn_gui.exe" Guid="{EC5742CF-E221-497C-A411-6CF74A298612}">
                        <Shortcut
                            Id="shortcut.openvpn_gui.exe"
                            Name="$(var.PRODUCT_NAME) GUI"
                            Target="[BINDIR]openvpn-gui.exe"
                            WorkingDirectory="BINDIR"
                            Icon="openvpn.ico"/>
                        <RemoveFolder Id="shortcut.openvpn_gui.exe" On="uninstall"/>
                        <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="openvpn_gui.exe" Type="integer" Value="1"/>
                    </Component>

                    <Directory Id="DocumentationShortcutFolder" Name="Documentation">
                        <Component Id="shortcut.doc.INSTALL_win32.txt" Guid="{B9929143-87F7-4BE8-A4A8-C5A41E6E180D}">
                            <Shortcut
                                Id="shortcut.doc.INSTALL_win32.txt"
                                Name="$(var.PRODUCT_NAME) Windows Notes"
                                Target="[DOCDIR]INSTALL-win32.txt"
                                WorkingDirectory="DOCDIR"/>
                            <RemoveFolder Id="shortcut.doc.INSTALL_win32.txt" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="doc.INSTALL_win32.txt" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.doc.openvpn.8.html" Guid="">
                            <Shortcut
                                Id="shortcut.doc.openvpn.8.html"
                                Name="$(var.PRODUCT_NAME) Manual Page"
                                Target="[DOCDIR]openvpn.8.html"
                                WorkingDirectory="DOCDIR"/>
                            <RemoveFolder Id="shortcut.doc.openvpn.8.html" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="doc.openvpn.8.html" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.doc.howto.url" Guid="{0C89847F-45F6-4BBF-9B20-B5FA9BD69906}">
                            <Shortcut
                                Id="shortcut.doc.howto.url"
                                Name="$(var.PRODUCT_NAME) HOWTO"
                                Target="[DOCDIR]$(var.PRODUCT_NAME) HOWTO.url"
                                WorkingDirectory="DOCDIR"
                                Icon="url.ico"/>
                            <RemoveFolder Id="shortcut.doc.howto.url" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="doc.howto.url" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.doc.support.url" Guid="{2CC129A7-745C-48A5-9C7B-8AFB770D0B85}">
                            <Shortcut
                                Id="shortcut.doc.support.url"
                                Name="$(var.PRODUCT_NAME) Support"
                                Target="[DOCDIR]$(var.PRODUCT_NAME) Support.url"
                                WorkingDirectory="DOCDIR"
                                Icon="url.ico"/>
                            <RemoveFolder Id="shortcut.doc.support.url" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="doc.support.url" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.doc.website.url" Guid="{9C270D5B-EDE6-4655-A01F-FD70F48C23AB}">
                            <Shortcut
                                Id="shortcut.doc.website.url"
                                Name="$(var.PRODUCT_NAME) Web Site"
                                Target="[DOCDIR]$(var.PRODUCT_NAME) Web Site.url"
                                WorkingDirectory="DOCDIR"
                                Icon="url.ico"/>
                            <RemoveFolder Id="shortcut.doc.website.url" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="doc.website.url" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.doc.wiki.url" Guid="{C36D5855-EBE3-4705-B851-96C8A01378DF}">
                            <Shortcut
                                Id="shortcut.doc.wiki.url"
                                Name="$(var.PRODUCT_NAME) Wiki"
                                Target="[DOCDIR]$(var.PRODUCT_NAME) Wiki.url"
                                WorkingDirectory="DOCDIR"
                                Icon="url.ico"/>
                            <RemoveFolder Id="shortcut.doc.wiki.url" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="doc.wiki.url" Type="integer" Value="1"/>
                        </Component>
                    </Directory>

                    <Directory Id="ShortcutsShortcutFolder" Name="Shortcuts">
                        <Component Id="shortcut.cfg" Guid="{54EDFEF4-E2FB-4310-BC46-74D3CAEB8C03}">
                            <Shortcut
                                Id="shortcut.cfg"
                                Name="$(var.PRODUCT_NAME) Configuration File Directory"
                                Target="[CONFIGDIR]"
                                WorkingDirectory="CONFIGDIR"/>
                            <RemoveFolder Id="shortcut.cfg" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="cfg" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.log" Guid="{FD94C038-D421-40D8-8690-B102625AA784}">
                            <Shortcut
                                Id="shortcut.log"
                                Name="$(var.PRODUCT_NAME) Log File Directory"
                                Target="[LOGDIR]"
                                WorkingDirectory="LOGDIR"/>
                            <RemoveFolder Id="shortcut.log" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="log" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.samplecfg" Guid="{32183788-F4CB-4D15-B58A-0C222C201151}">
                            <Shortcut
                                Id="shortcut.samplecfg"
                                Name="$(var.PRODUCT_NAME) Sample Configuration Files"
                                Target="[SAMPLECFGDIR]"
                                WorkingDirectory="SAMPLECFGDIR"/>
                            <RemoveFolder Id="shortcut.samplecfg" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="samplecfg" Type="integer" Value="1"/>
                        </Component>
                    </Directory>

                    <Directory Id="UtilitiesShortcutFolder" Name="Utilities">
                        <Component Id="shortcut.bin.openvpn.exe.genkey" Guid="{14C9864E-E4D7-401E-B337-2AEBF5E40735}">
                            <Shortcut
                                Id="shortcut.bin.openvpn.exe.genkey"
                                Name="Generate a static $(var.PRODUCT_NAME) key"
                                Target="[BINDIR]openvpn.exe"
                                Arguments="--pause-exit --verb 3 --genkey --secret &quot;%USERPROFILE%\Desktop\My $(var.PRODUCT_NAME) Key.txt&quot;"
                                WorkingDirectory="BINDIR"
                                Icon="genkey.ico"/>
                            <RemoveFolder Id="shortcut.bin.openvpn.exe.genkey" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="bin.openvpn.exe.genkey" Type="integer" Value="1"/>
                        </Component>
                        <Component Id="shortcut.bin.tapctl.exe.create" Guid="{F31F1774-326F-419F-B74E-29819E161321}">
                            <Shortcut
                                Id="shortcut.bin.tapctl.exe.create"
                                Name="Add a new TAP virtual ethernet adapter"
                                Target="[BINDIR]tapctl.exe"
                                Arguments="create"
                                WorkingDirectory="BINDIR"
                                Icon="tapctl_create.ico"/>
                            <RemoveFolder Id="shortcut.bin.tapctl.exe.create" On="uninstall"/>
                            <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="bin.tapctl.exe.create" Type="integer" Value="1"/>
                        </Component>
                    </Directory>
                </Directory>
            </Directory>

            <Directory Id="DesktopFolder">
                <Component Id="shortcut.openvpn_gui.exe.desktop" Guid="{B8D9B27E-CCA2-4384-8563-3C80A8FD109B}">
                    <Shortcut
                        Id="shortcut.openvpn_gui.exe.desktop"
                        Name="$(var.PRODUCT_NAME) GUI"
                        Target="[BINDIR]openvpn-gui.exe"
                        WorkingDirectory="BINDIR"
                        Icon="openvpn.ico"/>
                    <RemoveFolder Id="shortcut.openvpn_gui.exe.desktop" On="uninstall"/>
                    <RegistryValue Root="HKCU" Key="Software\$(var.PRODUCT_NAME)\Shortcuts" Name="openvpn_gui.exe.desktop" Type="integer" Value="1"/>
                </Component>
            </Directory>
        </Directory>


        <!--
            Registry entries
        -->
        <DirectoryRef Id="PRODUCTDIR">
            <Component Id="reg.path" Guid="{5FF63993-1F41-4EEF-8E04-2C9F10F7C1DC}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Type="string"
                    Value="[PRODUCTDIR]"/>
            </Component>
            <Component Id="reg.config_dir" Guid="{FA8F296E-3808-4861-AEC1-A14062D060AF}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="config_dir"
                    Type="string"
                    Value="[CONFIGDIR]"/>
            </Component>
            <Component Id="reg.config_ext" Guid="{A5CD806D-8E76-4A2F-86E9-B7FDE718088A}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="config_ext"
                    Type="string"
                    Value="$(var.CONFIG_EXTENSION)"/>
            </Component>
            <Component Id="reg.disable_save_passwords" Guid="{217D5F60-6F8B-48D1-9B7A-67CDC4511A5E}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="disable_save_passwords"
                    Type="integer"
                    Value="[DISABLESAVEPWD]"/>
            </Component>
            <Component Id="reg.exe_path" Guid="{36718C27-DA91-428D-AF1F-71E9325B6AFB}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="exe_path"
                    Type="string"
                    Value="[BINDIR]openvpn.exe"/>
            </Component>
            <Component Id="reg.log_append" Guid="{BAC3CB98-4C57-4AA3-A4EC-A1D49B8EF90E}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="log_append"
                    Type="string"
                    Value="[LOGAPPEND]"/>
            </Component>
            <Component Id="reg.log_dir" Guid="{4ED153F2-E679-4B3E-8D6F-BDD0628195CE}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="log_dir"
                    Type="string"
                    Value="[LOGDIR]"/>
            </Component>
            <Component Id="reg.ovpn_admin_group" Guid="{FCFFC52F-C813-4DC6-9988-F99DB57FE480}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="ovpn_admin_group"
                    Type="string"
                    Value="[ADMINGROUP]"/>
            </Component>
            <Component Id="reg.priority" Guid="{7D7E99C2-5BDD-4F52-BDE8-666A4403B64F}">
                <RegistryValue
                    Root="HKLM"
                    Key="Software\$(var.PRODUCT_NAME)"
                    Name="priority"
                    Type="string"
                    Value="[PRIORITY]"/>
            </Component>
            <Component Id="reg.conf.extension" Guid="{D93FFD42-2380-490A-8764-52AAC4896ED7}">
                <RegistryValue
                    Root="HKCR"
                    Key=".$(var.CONFIG_EXTENSION)"
                    Type="string"
                    Value="$(var.PRODUCT_NAME)File"/>
            </Component>
            <Component Id="reg.conf.descr" Guid="{4801346D-45CB-4C8D-A4B1-497066AA4557}">
                <RegistryValue
                    Root="HKCR"
                    Key="$(var.PRODUCT_NAME)File"
                    Type="string"
                    Value="$(var.PRODUCT_NAME) Config File"/>
            </Component>
            <Component Id="reg.conf.verb.default" Guid="{424B0990-09A2-4390-8616-E0A1D8116EFB}">
                <RegistryValue
                    Root="HKCR"
                    Key="$(var.PRODUCT_NAME)File\shell"
                    Type="string"
                    Value="open"/>
            </Component>
            <Component Id="reg.conf.icon" Guid="{9C61734E-69E5-4638-A400-2AD0517F5AEC}">
                <RegistryValue
                    Root="HKCR"
                    Key="$(var.PRODUCT_NAME)File\DefaultIcon"
                    Type="string"
                    Value="[RESDIR]ovpn.ico,0"/>
            </Component>
            <Component Id="reg.conf.open.command" Guid="{F11A8A05-AB43-4C06-BF35-C59B77E3F7BB}">
                <RegistryValue
                    Root="HKCR"
                    Key="$(var.PRODUCT_NAME)File\shell\open\command"
                    Type="string"
                    Value="&quot;[EDITOR]&quot; &quot;%1&quot;"/>
            </Component>
            <Component Id="reg.conf.run" Guid="{32B39844-BBDD-4D10-AD89-64F2A955E101}">
                <RegistryValue
                    Root="HKCR"
                    Key="$(var.PRODUCT_NAME)File\shell\run"
                    Type="string"
                    Value="Start $(var.PRODUCT_NAME) on this config file"/>
            </Component>
            <Component Id="reg.conf.run.command" Guid="{1F23876D-F1BB-4154-9248-AC1C7700FA99}">
                <RegistryValue
                    Root="HKCR"
                    Key="$(var.PRODUCT_NAME)File\shell\run\command"
                    Type="string"
                    Value="&quot;[BINDIR]openvpn.exe&quot; &#45;&#45;pause-exit &#45;&#45;config &quot;%1&quot;"/>
            </Component>
            <Component Id="reg.openvpngui.startup" Guid="{073B129C-665D-4CF6-9E10-91A132C4B4BA}">
                <RegistryKey
                    Root="HKCU"
                    Key="Software\Microsoft\Windows\CurrentVersion\Run"
                    ForceCreateOnInstall="yes">
                    <RegistryValue
                        Name="$(var.PRODUCT_NAME)-GUI"
                        Type="string"
                        Value="[BINDIR]openvpn-gui.exe"/>
                </RegistryKey>
            </Component>
        </DirectoryRef>


        <!--
            Configure Active Setup to install HKCU registry entries by triggering a repair when other users logs in.
        -->
        <Binary
            Id="ActiveSetupCA.js"
            SourceFile="script\ActiveSetupCA.js"/>

        <CustomAction Id="EvaluateActiveSetup" BinaryKey="ActiveSetupCA.js" JScriptCall="EvaluateActiveSetup"/>
        <CustomAction Id="PublishActiveSetup"  BinaryKey="ActiveSetupCA.js" JScriptCall="PublishActiveSetup" Execute="commit" Impersonate="no"/>
        <InstallExecuteSequence>
            <Custom Action="EvaluateActiveSetup" After="ProcessComponents"/>
            <Custom Action="PublishActiveSetup"  After="PublishProduct"/>
        </InstallExecuteSequence>

        <UI>
            <ProgressText Action="EvaluateActiveSetup">Evaluating Active Setup components</ProgressText>
            <ProgressText Action="PublishActiveSetup">Publishing Active Setup components</ProgressText>
        </UI>


        <!--
            TAP interfaces
        -->
        <Binary
            Id="libopenvpnmsica.dll"
            SourceFile="!(bindpath.openvpn)bin\libopenvpnmsica.dll"/>

        <CustomAction Id="FindTAPInterfaces"              BinaryKey="libopenvpnmsica.dll" DllEntry="FindTAPInterfaces"     Execute="firstSequence"/>
        <CustomAction Id="EvaluateTAPInterfaces"          BinaryKey="libopenvpnmsica.dll" DllEntry="EvaluateTAPInterfaces"/>
        <CustomAction Id="UninstallTAPInterfaces"         BinaryKey="libopenvpnmsica.dll" DllEntry="ProcessDeferredAction" Execute="deferred" Impersonate="no"/>
        <CustomAction Id="UninstallTAPInterfacesCommit"   BinaryKey="libopenvpnmsica.dll" DllEntry="ProcessDeferredAction" Execute="commit"   Impersonate="no"/>
        <CustomAction Id="UninstallTAPInterfacesRollback" BinaryKey="libopenvpnmsica.dll" DllEntry="ProcessDeferredAction" Execute="rollback" Impersonate="no"/>
        <CustomAction Id="InstallTAPInterfaces"           BinaryKey="libopenvpnmsica.dll" DllEntry="ProcessDeferredAction" Execute="deferred" Impersonate="no"/>
        <CustomAction Id="InstallTAPInterfacesCommit"     BinaryKey="libopenvpnmsica.dll" DllEntry="ProcessDeferredAction" Execute="commit"   Impersonate="no"/>
        <CustomAction Id="InstallTAPInterfacesRollback"   BinaryKey="libopenvpnmsica.dll" DllEntry="ProcessDeferredAction" Execute="rollback" Impersonate="no"/>

        <InstallUISequence>
            <Custom Action="FindTAPInterfaces" After="FindRelatedProducts"/>
        </InstallUISequence>

        <InstallExecuteSequence>
            <Custom Action="FindTAPInterfaces"               After="FindRelatedProducts"/>
            <Custom Action="EvaluateTAPInterfaces"           After="ProcessComponents"/>
            <Custom Action="UninstallTAPInterfaces"          After="DeleteServices"/>
            <Custom Action="UninstallTAPInterfacesCommit"    After="UninstallTAPInterfaces"/>
            <Custom Action="UninstallTAPInterfacesRollback" Before="UninstallTAPInterfaces"/>
            <Custom Action="InstallTAPInterfaces"           Before="InstallServices"/>
            <Custom Action="InstallTAPInterfacesCommit"      After="InstallTAPInterfaces"/>
            <Custom Action="InstallTAPInterfacesRollback"   Before="InstallTAPInterfaces"/>
        </InstallExecuteSequence>

        <Property Id="TAPINTERFACES" Secure="yes"/>

        <UI>
            <ProgressText
                Action="FindTAPInterfaces"
                Template="Found interface: [1]">Searching for TAP interfaces</ProgressText>
            <ProgressText
                Action="EvaluateTAPInterfaces">Evaluating TAP interfaces</ProgressText>
            <ProgressText
                Action="UninstallTAPInterfaces"
                Template="[1]: [2] [3]">Deleting TAP interfaces</ProgressText>
            <ProgressText
                Action="InstallTAPInterfaces"
                Template="[1]: [2] [3]">Creating TAP interfaces</ProgressText>

            <Error Id="2550">TAPCA: [2]</Error>
            <Error Id="2551">TAPCA: [2]  Error [3]: [4]</Error>
        </UI>

        <CustomTable Id="TAPInterface">
            <Column
                Id="Interface"
                Description="Primary key used to identify a particular interface record."
                Category="Identifier"
                Type="string"
                Width="72"
                Nullable="no"
                Localizable="no"
                PrimaryKey="yes"/>

            <Column
                Id="DisplayName"
                Description="Interface display name, may be localized."
                Category="Filename"
                Type="string"
                Width="255"
                Nullable="yes"
                Localizable="yes"/>

            <Column
                Id="Condition"
                Description="A conditional that can control whether a TAP interface is installed. If the condition is null or evaluates to true, then the interface is installed when its component is installed. Note: When its component is uninstalled, the TAP interface is unconditionally uninstalled."
                Category="Condition"
                Type="string"
                Width="255"
                Nullable="yes"
                Localizable="no"/>

            <Column
                Id="Component_"
                Description="Foreign key into the Component table denoting the component whose selection gates the the interface creation/deletion."
                Category="Identifier"
                Type="string"
                Width="72"
                Nullable="no"
                Localizable="no"
                KeyTable="Component"
                KeyColumn="1"/>

            <Row>
                <Data Column="Interface"  >TAP</Data>
                <Data Column="DisplayName">$(var.PRODUCT_NAME)</Data>
                <Data Column="Condition"  >NOT TAPINTERFACES</Data>
                <Data Column="Component_" >driver.OemVista.inf</Data>
            </Row>
        </CustomTable>


        <!--
            Features
        -->
        <Property Id="INSTALLLEVEL" Value="2"/>
        <Feature
            Id="OpenVPN"
            Title="$(var.PRODUCT_NAME) User-Space Components"
            Description="User-space components, including openvpn.exe"
            Level="2"
            ConfigurableDirectory="PRODUCTDIR"
            AllowAdvertise="no"
            Display="expand">
            <ComponentRef Id="license.txt"/>
            <ComponentRef Id="bin.libcrypto_1_1.dll"/>
            <ComponentRef Id="bin.liblzo2_2.dll"/>
            <ComponentRef Id="bin.libpkcs11_helper_1.dll"/>
            <ComponentRef Id="bin.libssl_1_1.dll"/>
            <ComponentRef Id="bin.openvpn.exe"/>
            <ComponentRef Id="cfg.README.txt"/>
            <ComponentRef Id="doc.INSTALL_win32.txt"/>
            <ComponentRef Id="doc.openvpn.8.html"/>
            <ComponentRef Id="doc.howto.url"/>
            <ComponentRef Id="doc.support.url"/>
            <ComponentRef Id="doc.website.url"/>
            <ComponentRef Id="doc.wiki.url"/>
            <ComponentRef Id="log.README.txt"/>
            <ComponentRef Id="res.ovpn.ico"/>
            <ComponentRef Id="samplecfg.client.$(var.CONFIG_EXTENSION)"/>
            <ComponentRef Id="samplecfg.sample.$(var.CONFIG_EXTENSION)"/>
            <ComponentRef Id="samplecfg.server.$(var.CONFIG_EXTENSION)"/>
            <ComponentRef Id="shortcut.bin.openvpn.exe.genkey"/>
            <ComponentRef Id="shortcut.doc.INSTALL_win32.txt"/>
            <ComponentRef Id="shortcut.doc.openvpn.8.html"/>
            <ComponentRef Id="shortcut.doc.howto.url"/>
            <ComponentRef Id="shortcut.doc.support.url"/>
            <ComponentRef Id="shortcut.doc.website.url"/>
            <ComponentRef Id="shortcut.doc.wiki.url"/>
            <ComponentRef Id="reg.path"/>
            <ComponentRef Id="reg.config_dir"/>
            <ComponentRef Id="reg.config_ext"/>
            <ComponentRef Id="reg.exe_path"/>
            <ComponentRef Id="reg.log_append"/>
            <ComponentRef Id="reg.log_dir"/>
            <ComponentRef Id="reg.ovpn_admin_group"/>
            <ComponentRef Id="reg.priority"/>
            <ComponentRef Id="reg.conf.extension"/>
            <ComponentRef Id="reg.conf.descr"/>
            <ComponentRef Id="reg.conf.verb.default"/>
            <ComponentRef Id="reg.conf.icon"/>
            <ComponentRef Id="reg.conf.open.command"/>
            <ComponentRef Id="reg.conf.run"/>
            <ComponentRef Id="reg.conf.run.command"/>
            <ComponentRef Id="shortcut.cfg"/>
            <ComponentRef Id="shortcut.log"/>
            <ComponentRef Id="shortcut.samplecfg"/>

            <Feature
                Id="OpenVPN.Service"
                Title="$(var.PRODUCT_NAME) Service"
                Description="Service wrappers"
                Level="3"
                ConfigurableDirectory="PRODUCTDIR"
                AllowAdvertise="no">
                <ComponentRef Id="bin.openvpnserv2.exe"/>
            </Feature>

            <Feature
                Id="OpenVPN.GUI"
                Title="$(var.PRODUCT_NAME) GUI"
                Description="GUI by Mathias Sundman"
                Level="2"
                ConfigurableDirectory="PRODUCTDIR"
                AllowAdvertise="no"
                Display="expand">
                <ComponentRef Id="bin.openvpn_gui.exe"/>
                <ComponentRef Id="bin.openvpnserv.exe"/>
                <ComponentRef Id="shortcut.openvpn_gui.exe"/>
                <ComponentRef Id="shortcut.openvpn_gui.exe.desktop"/>
                <ComponentRef Id="reg.disable_save_passwords"/>

                <Feature
                    Id="OpenVPN.GUI.OnLogon"
                    Title="Launch on User Logon"
                    Level="2"
                    ConfigurableDirectory="PRODUCTDIR"
                    AllowAdvertise="no">
                    <ComponentRef Id="reg.openvpngui.startup"/>
                </Feature>
            </Feature>
        </Feature>

        <Feature
            Id="TAP"
            Title="TUN/TAP Driver"
            Description="TAP virtual Ethernet adapter driver"
            Level="1"
            ConfigurableDirectory="PRODUCTDIR"
            AllowAdvertise="no"
            Display="expand"
            Absent="disallow">
            <ComponentRef Id="license.txt"/>
            <ComponentRef Id="driver.OemVista.inf"/>
            <ComponentRef Id="driver.$(var.PRODUCT_TAP_WIN_COMPONENT_ID).cat"/>
            <ComponentRef Id="driver.$(var.PRODUCT_TAP_WIN_COMPONENT_ID).sys"/>

            <Feature
                Id="TAP.Util"
                Title="Utilities"
                Description="Command-line utilities to manage TAP interfaces"
                Level="2"
                ConfigurableDirectory="PRODUCTDIR"
                AllowAdvertise="no">
                <ComponentRef Id="bin.tapctl.exe"/>
                <ComponentRef Id="shortcut.bin.tapctl.exe.create"/>
            </Feature>

            <Feature
                Id="TAP.SDK"
                Title="SDK"
                Description="C/C++ header files to access TAP interfaces programmatically"
                Level="3"
                ConfigurableDirectory="PRODUCTDIR"
                AllowAdvertise="no">
                <ComponentRef Id="include.tap_windows.h"/>
            </Feature>
        </Feature>

        <Feature
            Id="OpenSSL"
            Title="OpenSSL Utilities"
            Description="Used for generating public/private key pairs"
            Level="3"
            ConfigurableDirectory="PRODUCTDIR"
            AllowAdvertise="no"
            Display="expand">
            <ComponentRef Id="license.txt"/>
            <ComponentRef Id="bin.openssl.exe"/>
            <ComponentRef Id="bin.libcrypto_1_1.dll"/>
            <ComponentRef Id="bin.libssl_1_1.dll"/>

            <Feature
                Id="EasyRSA"
                Title="EasyRSA 2 Certificate Management Scripts"
                Description="Scripts for X509 certificate management"
                Level="3"
                ConfigurableDirectory="EASYRSADIR"
                AllowAdvertise="no">
                <ComponentRef Id="easyrsa.build_ca.bat"/>
                <ComponentRef Id="easyrsa.build_dh.bat"/>
                <ComponentRef Id="easyrsa.build_key.bat"/>
                <ComponentRef Id="easyrsa.build_key_pass.bat"/>
                <ComponentRef Id="easyrsa.build_key_pkcs12.bat"/>
                <ComponentRef Id="easyrsa.build_key_server.bat"/>
                <ComponentRef Id="easyrsa.clean_all.bat"/>
                <ComponentRef Id="easyrsa.index.txt.start"/>
                <ComponentRef Id="easyrsa.init_config.bat"/>
                <ComponentRef Id="easyrsa.openssl_1.0.0.cnf"/>
                <ComponentRef Id="easyrsa.README.txt"/>
                <ComponentRef Id="easyrsa.revoke_full.bat"/>
                <ComponentRef Id="easyrsa.serial.start"/>
                <ComponentRef Id="easyrsa.vars.bat.sample"/>
            </Feature>
        </Feature>


        <!--
            UI
        -->
        <InstallUISequence>
            <Show Dialog="PreparePage"          Before="FindRelatedProducts"/>
            <!--<Show Dialog="LicenseAgreementPage" Before="SetupTypePage">NOT Installed</Show>-->
            <Show Dialog="SetupTypePage"        Before="ProgressPage">NOT Installed</Show>
            <Show Dialog="ResumePage"           Before="ProgressPage">Installed AND (RESUME OR Preselected)</Show>
            <Show Dialog="MaintenanceTypePage"  Before="ProgressPage">Installed AND NOT RESUME AND NOT Preselected</Show>
            <Show Dialog="ProgressPage"         Before="ExecuteAction"/>

            <Show Dialog="ExitPage"       OnExit="success"/>
            <Show Dialog="UserExitPage"   OnExit="cancel"/>
            <Show Dialog="FatalErrorPage" OnExit="error"/>
        </InstallUISequence>

        <AdminUISequence>
            <Show Dialog="PreparePage"           Before="CostInitialize"/>
            <!--<Show Dialog="LicenseAgreementPage"  Before="AdminInstallPointPage"/>-->
            <Show Dialog="AdminInstallPointPage" Before="ProgressPage"/>
            <Show Dialog="ProgressPage"          Before="ExecuteAction"/>

            <Show Dialog="ExitPage"       OnExit="success"/>
            <Show Dialog="UserExitPage"   OnExit="cancel"/>
            <Show Dialog="FatalErrorPage" OnExit="error"/>
        </AdminUISequence>
    </Product>
</Wix>
